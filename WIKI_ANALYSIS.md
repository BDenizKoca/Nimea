# Wiki System Analysis & Recommendations

**Date**: 2025-11-14
**Project**: Nimea - Interactive TTRPG Wiki & Map System
**Focus**: Wiki structure, content management, and improvements

---

## Executive Summary

The Nimea wiki system is well-structured with clean Eleventy architecture, bilingual support (TR/EN), and good SEO practices. However, there are **6 missing English translations** and several opportunities for enhancement.

**Status**: âœ… Healthy foundation, minor content gaps, optimization opportunities

---

## 1. Current Wiki Structure

### Directory Layout
```
Nimea/
â”œâ”€â”€ wiki/ (Turkish - PRIMARY)
â”‚   â”œâ”€â”€ characters/        (4 files)
â”‚   â”œâ”€â”€ gods-religions/
â”‚   â”œâ”€â”€ locations-regions/
â”‚   â”œâ”€â”€ magic-powers/
â”‚   â”œâ”€â”€ nations-factions/
â”‚   â””â”€â”€ player-characters/
â”œâ”€â”€ en/wiki/ (English - SECONDARY)
â”‚   â””â”€â”€ [same structure as above]
â”œâ”€â”€ _includes/
â”‚   â””â”€â”€ base.njk          (Main template)
â”œâ”€â”€ _data/
â”‚   â””â”€â”€ i18n.json         (Translations)
â””â”€â”€ .eleventy.js          (Config)
```

### Content Statistics
- **Turkish pages**: 39 total
- **English pages**: 33 total
- **Missing EN translations**: 6 pages (15.4% untranslated)
- **Pages with map links**: 6 pages (15.4% have `map_id`)

---

## 2. Missing English Translations âš ï¸

The following pages exist in Turkish but **not in English**:

### Characters (3 missing)
1. `characters/klara-pena.md` - 151 bytes (stub/placeholder)
2. `characters/skribas-seravel.md` - 1.3KB (full content)
3. `characters/varkas-dragonslayer.md` - 1.2KB (full content)

### Locations (1 missing)
4. `locations-regions/aurelium.md`

### Nations/Factions (1 missing)
5. `nations-factions/empire-of-aurelius.md`

### Player Characters (1 missing)
6. `player-characters/marcus-arus.md`

**Impact**: English-speaking players cannot access ~15% of your world content. Language switcher links will break for these pages.

**Recommendation**: Create placeholder EN versions with "Translation in progress" message, or translate these 6 pages.

---

## 3. Technical Architecture Review âœ…

### Eleventy Configuration (.eleventy.js)
**Strengths**:
- âœ… Proper i18n support with `{% t %}` shortcode
- âœ… Collections properly defined for both TR/EN
- âœ… Passthrough copy correctly configured
- âœ… Clean separation of languages

**Potential Issue**:
- Lines 68, 70: Language switcher assumes `/en` prefix mapping
  ```njk
  <a href="{{ page.url | replace('/en', '') }}">TR</a>  <!-- EN â†’ TR -->
  <a href="{{ '/en' + page.url }}">EN</a>                <!-- TR â†’ EN -->
  ```
  This **breaks** for the 6 missing EN pages (404 error when clicking EN)

**Fix**: Add 404 handling or detect missing translations and disable language switcher for those pages.

---

### Template (base.njk)
**Strengths**:
- âœ… Excellent SEO: OpenGraph, Twitter cards, canonical links
- âœ… Language alternates properly configured (hreflang)
- âœ… Progressive Web App support (manifest, service worker)
- âœ… Netlify Identity integration for CMS
- âœ… Share functionality with fallbacks
- âœ… Image modal for inline images
- âœ… Accessibility (aria-live for search results)

**Minor Issues**:
1. **Line 200**: `/js/search.js` has absolute path (should be `{{ '/js/search.js' | url }}`)
   - Works now but could break if pathPrefix is added later
2. **Hardcoded text in JS**: Lines 148, 157 have inline i18n checks instead of using data
3. **No offline support indicator**: Service worker registered but no UI feedback

**Recommendation**: Use `{{ ... | url }}` filter consistently for all asset paths.

---

### Search System (search.js)
**Strengths**:
- âœ… Lightweight client-side search (no external dependencies)
- âœ… Turkish character normalization (ÄŸ, Ã¼, ÅŸ, Ã¶, Ã§, Ä±)
- âœ… Smart scoring: title > tokens > summary
- âœ… Merges markers from `/map/data/markers.json` at runtime
- âœ… Keyboard shortcut (`/` key to focus search)
- âœ… Bilingual results with language filtering

**Observations**:
- Fetches search index from `/search-index.json` (generated by `search-index.json.njk`)
- Max 12 results displayed
- Markers get slight penalty (`score -= 0.2`) to prioritize wiki pages

**Potential Improvement**: Add search debouncing (currently searches on every keystroke)

---

## 4. Content Quality Analysis

### Sample Content Review

**Example - Klara Pena (stub)**:
```markdown
---
layout: base.njk
name: Klara Pena
slug: klara-pena
summary: KÄ±sa Ã¶zet
cover_image: ""
portrait_image: ""
public: true
---
Klara pena kÄ±sa Ã¶zet
```
**Issue**: Almost no content (151 bytes). Summary repeated in body.

**Recommendation**: Either flesh out this character or mark as `public: false` to hide from search/navigation.

---

## 5. SEO & Performance Review âœ…

### Strengths
1. **Canonical URLs**: Properly configured (base.njk:13)
2. **Language Alternates**: hreflang tags for TR/EN (base.njk:14-22)
3. **Meta Descriptions**: Dynamic from frontmatter `summary` field
4. **Social Sharing**: OpenGraph + Twitter cards
5. **PWA Support**: Manifest + service worker + offline page
6. **Image Optimization**: `loading="lazy"` on images

### Performance Metrics (Estimated)
- **Search.js**: 6.4KB minified (good)
- **CSS**: 297 lines (minimal)
- **No jQuery or heavy frameworks** âœ…
- **Service worker caching** âœ…

**Recommendation**:
- Add `<link rel="preconnect" href="https://identity.netlify.com">` to speed up Netlify Identity widget
- Consider adding `font-display: swap` if using custom fonts

---

## 6. Map-Wiki Integration

### Current Integration Points

1. **Show on Map Button** (base.njk:90-94)
   - Appears on wiki pages with `map_id` frontmatter
   - Links to `/map/?focus=<marker_id>`
   - Bilingual labels

2. **Search Integration** (search.js:76-91)
   - Markers from `markers.json` appear in search results
   - Search redirects to map with `?focus=` parameter
   - Smart routing: if already on map, calls `window.routeUI.focusMarker()`

**Statistics**: Only 6/39 wiki pages (15%) have `map_id` links

**Recommendation**: Add `map_id` to more location/city/region pages to improve map-wiki crosslinking.

---

## 7. Accessibility Review

### Strengths
- âœ… Semantic HTML structure
- âœ… `aria-live="polite"` on search results
- âœ… Keyboard navigation support (`/` search shortcut, `Escape` to close)
- âœ… `alt` attributes on images

### Missing
- âš ï¸ No skip-to-content link
- âš ï¸ No focus visible styles (keyboard users can't see where they are)
- âš ï¸ Image modal missing `aria-label` and `role="dialog"`
- âš ï¸ Share button could use `aria-label="Share this page"`

**Recommendation**: Add basic focus styles and ARIA attributes for screen readers.

---

## 8. Recommended Improvements

### High Priority ğŸ”´

1. **Fix Missing EN Translations**
   - Create placeholder pages for the 6 missing EN pages
   - OR translate them fully
   - OR disable EN language switcher for untranslated pages

2. **Add Focus Styles for Keyboard Navigation**
   ```css
   *:focus-visible {
       outline: 2px solid #667eea;
       outline-offset: 2px;
   }
   ```

3. **Fix Absolute Path in base.njk**
   ```njk
   <!-- CHANGE: -->
   <script src="/js/search.js" defer></script>

   <!-- TO: -->
   <script src="{{ '/js/search.js' | url }}" defer></script>
   ```

---

### Medium Priority ğŸŸ¡

4. **Add Search Debouncing**
   - Currently searches on every keystroke
   - Could cause performance issues with large indexes
   - Debounce to 150ms delay

5. **Improve Stub Pages**
   - Pages like `klara-pena.md` (151 bytes) should either:
     - Be fleshed out with actual content
     - Marked as `public: false` to hide from navigation
     - Have a "Work in Progress" notice

6. **Add More Map Links**
   - Only 6/39 pages have `map_id`
   - All location/city/region pages should link to map
   - Benefits player navigation

7. **404 Page Localization**
   - Current `404.md` is not language-aware
   - Should detect language and show appropriate message

---

### Low Priority ğŸŸ¢

8. **Add Preconnect for Netlify Identity**
   ```html
   <link rel="preconnect" href="https://identity.netlify.com">
   ```

9. **Image Modal Accessibility**
   ```html
   <div class="image-modal-overlay"
        id="image-modal-overlay"
        role="dialog"
        aria-label="Image preview">
   ```

10. **Content Statistics Dashboard**
    - Create a build-time script to show:
      - Total pages per language
      - Missing translations
      - Pages without map links
      - Average content length

11. **Add Reading Time Estimate**
    ```njk
    {% set wordCount = content | striptags | wordcount %}
    {% set readTime = (wordCount / 200) | round %}
    <p class="read-time">{{ readTime }} min read</p>
    ```

---

## 9. Security Review âœ…

### Checked Items
- âœ… No hardcoded secrets or API keys
- âœ… No `http://` links (except localhost references)
- âœ… Netlify Identity used for admin auth
- âœ… Service worker doesn't cache sensitive data
- âœ… No `eval()` or `innerHTML` without sanitization

**Note**: Share functionality uses `navigator.share` API and clipboard API correctly (base.njk:139-163)

---

## 10. Build & Deployment

### Package.json Scripts
```json
"start": "eleventy --serve",  // Dev server
"build": "eleventy",           // Production build
"icons": "node scripts/generate-icons.js"  // PWA icons
```

### Dependencies
- `@11ty/eleventy`: ^3.1.2 âœ… (latest major version)
- `sharp`: ^0.33.3 âœ… (for icon generation)

**Recommendation**: Add these useful scripts:
```json
"scripts": {
  "start": "eleventy --serve",
  "build": "eleventy",
  "icons": "node scripts/generate-icons.js",
  "clean": "rm -rf _site",
  "lint:md": "markdownlint wiki/**/*.md en/wiki/**/*.md",
  "analyze": "node scripts/analyze-content.js"  // Check for missing translations
}
```

---

## 11. Summary & Action Items

### Current State
- âœ… **Solid foundation**: Clean architecture, good SEO, bilingual support
- âš ï¸ **Content gaps**: 6 missing EN translations (15%)
- âš ï¸ **Accessibility**: Missing focus styles and ARIA labels
- âœ… **Performance**: Lightweight, no bloat
- âœ… **Security**: No issues found

### Immediate Actions (Next 1-2 Days)

1. **Fix missing EN pages** - Create placeholders or translate
2. **Add focus styles** - Basic keyboard navigation visibility
3. **Fix absolute path** - Use `{{ ... | url }}` filter in base.njk:200

### Short-Term (Next Week)

4. Debounce search input
5. Add more `map_id` links to location pages
6. Improve stub pages (klara-pena, etc.)

### Long-Term (Next Month)

7. Add content statistics dashboard
8. Implement reading time estimates
9. Enhance image modal accessibility
10. Create automated translation checker

---

## 12. Conclusion

Your wiki system is **professionally built** with modern best practices. The Eleventy setup is clean, the bilingual support works well, and the map-wiki integration is clever.

**Main weakness**: Content completeness (missing EN translations, stub pages)

**Main strength**: Technical architecture and SEO optimization

**Overall Grade**: **A-** (Would be A+ with complete translations and accessibility fixes)

---

**Generated**: 2025-11-14
**Tools Used**: File analysis, grep, diff, manual code review
**Related Docs**: ROUTING_SYSTEM_DEEP_DIVE.md, PORT_ROUTING_ANALYSIS.md
